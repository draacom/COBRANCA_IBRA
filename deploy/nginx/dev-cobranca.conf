server {
    listen 80;
    server_name cobranca.ibrainformatica.com.br;

    # Frontend dev (CRA) em 3003 com HMR/WebSocket
    location /sockjs-node/ {
        proxy_pass http://154.38.191.226:3003;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $host;
    }

    location /static/         { proxy_pass http://154.38.191.226:3003; }
    location /asset-manifest.json { proxy_pass http://154.38.191.226:3003; }
    location /favicon.ico     { proxy_pass http://154.38.191.226:3003; }

    # Backend API e páginas públicas
    location /api/    { proxy_pass http://154.38.191.226:3001; }
    location /public/ { proxy_pass http://154.38.191.226:3001; }
    # Alias: permitir acesso via /invoice/<id> à rota pública
    location ^~ /invoice/ {
        rewrite ^/invoice/(.*)$ /public/invoice/$1 break;
        proxy_pass http://154.38.191.226:3001;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
    }

    # Demais rotas → frontend dev
    location / {
        proxy_pass http://154.38.191.226:3003;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
    }
}
